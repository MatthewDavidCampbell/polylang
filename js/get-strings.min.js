jQuery(document).ready(function($) {

	$(document).on("click", "#pll_scan_theme_and_plugins", function() {
		var data = {
			action: 'get-strings'
		}

		$.post(ajaxurl, data, function(r, stat) {
			if ( 0 == r || 'success' != stat )
				r = wpAjax.broken;

			r = r.substring(0, r.length - 1);

			if (r == 'null') {
				$("#pll_scan_theme_and_plugins").before("<p class='pll_disappear'>No new strings have been found.</p>");
			}
			else {
				var lines = JSON.parse(r);
				for (var i in lines) {
					$("#pll_scan_theme_and_plugins").before("<p class='pll_disappear'>'" + lines[i].string + "' from domain '" + lines[i].domain + "' was added (found in " + lines[i].file + " on line " + lines[i].line + ").</p>");
				}
			}

			setTimeout(function() {
				$(".pll_disappear").fadeOut("slow");
			}, 3000);
		});
	});
});